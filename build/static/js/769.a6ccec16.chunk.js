"use strict";(self.webpackChunkvsa_website=self.webpackChunkvsa_website||[]).push([[769],{1033:(e,t,r)=>{r.d(t,{s:()=>s});var a=r(9950);function s(e){let{title:t}=e;return(0,a.useEffect)((()=>(document.title="VSA - ".concat(t),()=>{document.title="VSA"})),[t]),null}},5769:(e,t,r)=>{r.r(t),r.d(t,{Leaderboard:()=>x});var a=r(8),s=r(9950),n=r(2348),i=r(1033),d=r(8671),c=r(7196),o=r(6601),l=r(4414);function x(){const[e,t]=(0,s.useState)([]),[r,x]=(0,s.useState)([]),[p,u]=(0,s.useState)(!0),[h,g]=(0,s.useState)(null),[m,y]=(0,s.useState)("points"),{refreshPoints:f}=(0,d.m)(),v=async()=>{try{u(!0);const{data:e,error:r}=await n.N.from("user_points").select("\n          user_id,\n          points,\n          user_profiles!inner (\n            first_name,\n            last_name,\n            is_admin,\n            avatar_url\n          )\n        ").order("points",{ascending:!1});if(r)throw r;const{data:s,error:i}=await n.N.from("event_attendance").select("user_id, event_id").not("user_id","is",null);if(i)throw i;const d=s.reduce(((e,t)=>(e[t.user_id]=(e[t.user_id]||0)+1,e)),{}),c=e.filter((e=>!e.user_profiles.is_admin)).map(((e,t)=>({id:e.user_id,first_name:e.user_profiles.first_name,last_name:e.user_profiles.last_name,points:e.points,eventsAttended:d[e.user_id]||0,rank:t+1,avatar_url:e.user_profiles.avatar_url})));t(c);const o=[...c].sort(((e,t)=>t.eventsAttended-e.eventsAttended)).map(((e,t)=>(0,a.A)((0,a.A)({},e),{},{rank:t+1})));x(o)}catch(e){console.error("Error fetching leaderboard:",e),g("Failed to fetch leaderboard data")}finally{u(!1)}};return(0,s.useEffect)((()=>{v();const e=n.N.channel("points_changes").on("postgres_changes",{event:"*",schema:"public",table:"user_points"},(()=>{v(),f()})).subscribe();return()=>{e.unsubscribe()}}),[f]),p?(0,l.jsx)("div",{children:"Loading..."}):h?(0,l.jsxs)("div",{children:["Error: ",h]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.s,{title:"Leaderboard"}),(0,l.jsx)("div",{className:"flex justify-center items-start bg-gray-50 dark:bg-gray-950 transition-colors duration-300",children:(0,l.jsxs)("div",{className:"w-full max-w-6xl px-4 py-4",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-6 text-center",children:"Leaderboard"}),(0,l.jsx)(c.T,{children:(0,l.jsx)("div",{className:"flex justify-center mb-8",children:(0,l.jsxs)("div",{className:"inline-flex rounded-lg border border-gray-200 dark:border-gray-700 p-1 bg-white dark:bg-gray-800",children:[(0,l.jsx)("button",{onClick:()=>y("points"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 ".concat("points"===m?"bg-indigo-600 text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:"Points"}),(0,l.jsx)("button",{onClick:()=>y("events"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 ".concat("events"===m?"bg-indigo-600 text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:"Events Attended"})]})})}),(0,l.jsx)(c.T,{children:(0,l.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,l.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{scope:"col",className:"w-20 px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Rank"}),(0,l.jsx)("th",{scope:"col",className:"w-20 px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Avatar"}),(0,l.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),(0,l.jsx)("th",{scope:"col",className:"w-32 px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"points"===m?"Points":"Events Attended"})]})}),(0,l.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:("points"===m?e:r).map(((e,t)=>(0,l.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white text-center",children:t+1}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white text-center",children:(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsx)(o.e,{size:"sm",userId:e.id})})}),(0,l.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:[e.first_name," ",e.last_name]}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white text-center",children:"points"===m?e.points:e.eventsAttended})]},e.id)))})]})})})})]})})]})}},7196:(e,t,r)=>{r.d(t,{T:()=>n});r(9950);var a=r(1132),s=r(4414);const n=e=>{let{children:t}=e;return(0,s.jsx)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:t})}}}]);