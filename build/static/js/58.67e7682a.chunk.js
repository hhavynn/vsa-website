"use strict";(self.webpackChunkvsa_website=self.webpackChunkvsa_website||[]).push([[58],{58:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var n=r(8),a=r(9950),s=r(4158),i=r(2348),o=r(5044),l=r(1033),d=r(6268),c=r(4414);function g(e){let{eventId:t,onSuccess:r}=e;const[n,s]=(0,a.useState)(""),[o,l]=(0,a.useState)([]),[g,u]=(0,a.useState)(null),[m,h]=(0,a.useState)(0),[x,b]=(0,a.useState)(!1),[v,p]=(0,a.useState)(null),[y,f]=(0,a.useState)(null),{manuallyCheckIn:w}=(0,d.Z)();return(0,c.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-xl p-6",children:[(0,c.jsx)("h2",{className:"text-2xl font-bold mb-4 text-white",children:"Manual Check-in"}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Search User"}),(0,c.jsxs)("div",{className:"flex space-x-2",children:[(0,c.jsx)("input",{type:"text",value:n,onChange:e=>s(e.target.value),placeholder:"Search by name or email",className:"flex-1 px-4 py-2 rounded-lg border border-gray-700 bg-gray-900 text-white shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",disabled:x}),(0,c.jsx)("button",{onClick:async()=>{try{b(!0),p(null),l([]);const{data:e,error:t}=await i.N.from("user_profiles").select("\n          id,\n          first_name,\n          last_name,\n          email\n        ").or("first_name.ilike.%".concat(n,"%,last_name.ilike.%").concat(n,"%,email.ilike.%").concat(n,"%")).limit(5);if(t)throw t;l(e||[])}catch(e){console.error("Error searching users:",e),p("Failed to search users. Please try again.")}finally{b(!1)}},disabled:x||!n.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:"Search"})]})]}),o.length>0&&(0,c.jsx)("div",{className:"space-y-2",children:o.map((e=>(0,c.jsxs)("button",{onClick:()=>u(e),className:"w-full text-left p-3 rounded-lg border ".concat((null===g||void 0===g?void 0:g.id)===e.id?"border-indigo-500 bg-indigo-900/20":"border-gray-700 hover:border-gray-600"),children:[(0,c.jsxs)("p",{className:"text-white font-medium",children:[e.first_name," ",e.last_name]}),(0,c.jsx)("p",{className:"text-sm text-gray-400",children:e.email})]},e.id)))}),g&&(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Points to Award"}),(0,c.jsx)("input",{type:"number",value:m,onChange:e=>h(Number(e.target.value)),min:"0",className:"w-full px-4 py-2 rounded-lg border border-gray-700 bg-gray-900 text-white shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,c.jsx)("button",{onClick:async()=>{if(g)try{b(!0),p(null),f(null);await w(t,g.id,m)&&(f("Successfully checked in ".concat(g.first_name," ").concat(g.last_name)),u(null),h(0),null===r||void 0===r||r())}catch(e){console.error("Error checking in user:",e),p(e instanceof Error?e.message:"Failed to check in user. Please try again.")}finally{b(!1)}},disabled:x||m<=0,className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:"Check In User"})]}),v&&(0,c.jsx)("div",{className:"p-4 rounded-lg bg-red-900/20 text-red-400 text-sm",children:v}),y&&(0,c.jsx)("div",{className:"p-4 rounded-lg bg-green-900/20 text-green-400 text-sm",children:y})]})]})}var u=r(9326);const m={other:"General Events",gbm:"General Body Meeting",mixer:"Mixer",winter_retreat:"Winter Retreat",vcn:"VCN",wildn_culture:"Wild n' Culture",external_event:"External Event"};function h(){console.log("AdminEvents component mounting...");const{events:e,refreshEvents:t}=(0,s.L)();console.log("Events data:",e);const[r,d]=(0,a.useState)(null),[h,x]=(0,a.useState)({name:"",description:"",date:"",location:"",event_type:"other",check_in_form_url:"",points:0}),[b,v]=(0,a.useState)(null),[p,y]=(0,a.useState)(null),[f,w]=(0,a.useState)(!1),[j,_]=(0,a.useState)(!1),[k,N]=(0,a.useState)(null),[E,C]=(0,a.useState)("create"),A=new Date,S=new Date(A.getTime()-864e5),D=e.filter((e=>new Date(e.date)>=S)).sort(((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())),q=e.filter((e=>new Date(e.date)<S)).sort(((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())),I=(0,a.useCallback)((e=>{const t=e[0];if(t){v(t);const e=new FileReader;e.onload=()=>{y(e.result)},e.readAsDataURL(t)}}),[]),{getRootProps:T,getInputProps:P,isDragActive:U}=(0,o.VB)({onDrop:I,accept:{"image/*":[".png",".jpg",".jpeg",".gif"]},maxFiles:1}),F=e=>{N(e),_(!0)};return(0,c.jsxs)("div",{className:"container mx-auto px-4 py-8 bg-gray-50 dark:bg-gray-950 transition-colors duration-300",children:[(0,c.jsx)(l.s,{title:"Event Management"}),(0,c.jsx)(u.z,{}),(0,c.jsxs)("div",{className:"flex space-x-4 mb-8",children:[(0,c.jsx)("button",{onClick:()=>C("create"),className:"px-4 py-2 rounded-lg ".concat("create"===E?"bg-indigo-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"," transition-colors duration-200"),children:"Event Creation"}),(0,c.jsx)("button",{onClick:()=>C("manage"),className:"px-4 py-2 rounded-lg ".concat("manage"===E?"bg-indigo-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"," transition-colors duration-200"),children:"Event Management"})]}),(0,c.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:"create"===E?(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Create New Event"}),(0,c.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),h.name&&h.description&&h.date&&h.location&&h.check_in_form_url)try{w(!0);let e=null;if(b){const t=b.name.split(".").pop(),r="".concat(Math.random(),".").concat(t),{error:n}=await i.N.storage.from("event_images").upload(r,b);if(n)throw n;const{data:a}=i.N.storage.from("event_images").getPublicUrl(r);e=null===a||void 0===a?void 0:a.publicUrl}const r=Math.random().toString(36).substring(2,8).toUpperCase(),{error:n}=await i.N.from("events").insert([{name:h.name,description:h.description,date:h.date,location:h.location,event_type:h.event_type,check_in_form_url:h.check_in_form_url,points:h.points,image_url:e,check_in_code:r,is_code_expired:!1}]);if(n)throw n;x({name:"",description:"",date:"",location:"",event_type:"other",check_in_form_url:"",points:0}),v(null),y(null),t()}catch(r){console.error("Error creating event:",r)}finally{w(!1)}},className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl p-6 text-gray-900 dark:text-white",children:(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Event Title"}),(0,c.jsx)("input",{type:"text",value:h.name,onChange:e=>x((0,n.A)((0,n.A)({},h),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Description"}),(0,c.jsx)("textarea",{value:h.description,onChange:e=>x((0,n.A)((0,n.A)({},h),{},{description:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:3,required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Date"}),(0,c.jsx)("input",{type:"datetime-local",value:h.date,onChange:e=>x((0,n.A)((0,n.A)({},h),{},{date:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Location"}),(0,c.jsx)("input",{type:"text",value:h.location,onChange:e=>x((0,n.A)((0,n.A)({},h),{},{location:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Event Type"}),(0,c.jsx)("select",{value:h.event_type,onChange:e=>x((0,n.A)((0,n.A)({},h),{},{event_type:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:Object.entries(m).map((e=>{let[t,r]=e;return(0,c.jsx)("option",{value:t,children:r},t)}))})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Points"}),(0,c.jsx)("input",{type:"number",value:h.points,onChange:e=>x((0,n.A)((0,n.A)({},h),{},{points:Number(e.target.value)})),min:"0",className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Check-in Form URL"}),(0,c.jsx)("input",{type:"url",value:h.check_in_form_url,onChange:e=>x((0,n.A)((0,n.A)({},h),{},{check_in_form_url:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,placeholder:"https://docs.google.com/forms/d/e/..."})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Event Image"}),(0,c.jsxs)("div",(0,n.A)((0,n.A)({},T()),{},{className:"mt-1 flex items-center justify-center border-2 border-dashed rounded-md p-4 cursor-pointer ".concat(U?"border-indigo-500 bg-indigo-50":"border-gray-600 bg-gray-700"),children:[(0,c.jsx)("input",(0,n.A)({},P())),p?(0,c.jsx)("img",{src:p,alt:"Event",className:"max-h-48 rounded-md object-cover"}):(0,c.jsx)("span",{className:"text-gray-400",children:"Drag & drop or click to select an image"})]})),b&&(0,c.jsx)("button",{type:"button",className:"mt-2 text-red-400 hover:underline",onClick:()=>{v(null),y(null)},children:"Remove Image"})]}),(0,c.jsx)("button",{type:"submit",className:"w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",disabled:f,children:f?"Creating...":"Create Event"})]})})]}):(0,c.jsxs)("div",{className:"space-y-6",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Manage Events"}),(0,c.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,c.jsxs)("div",{children:[(0,c.jsxs)("h3",{className:"text-xl font-semibold mb-4 text-white",children:["Upcoming Events (",D.length,")"]}),(0,c.jsx)("div",{className:"space-y-4",children:D.map((e=>(0,c.jsxs)("div",{onClick:()=>d(e),className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl p-6 cursor-pointer transition-colors ".concat((null===r||void 0===r?void 0:r.id)===e.id?"ring-2 ring-indigo-500":"hover:bg-gray-700"),children:[(0,c.jsxs)("div",{className:"flex justify-between items-start",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"text-xl font-bold mb-2 text-white",children:e.name}),(0,c.jsx)("p",{className:"text-gray-300 mb-4",children:e.description}),(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-400",children:new Date(e.date).toLocaleDateString()}),(0,c.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-indigo-900 text-indigo-200",children:m[e.event_type]})]})]}),(0,c.jsx)("button",{onClick:t=>{t.stopPropagation(),F(e.id)},className:"text-red-400 hover:text-red-500",children:"Delete"})]}),e.image_url&&(0,c.jsx)("div",{className:"mt-4",children:(0,c.jsx)("img",{src:e.image_url,alt:"Event Image",className:"w-full h-48 object-cover rounded-md"})})]},e.id)))})]}),(0,c.jsx)("div",{className:"border-t border-gray-700 my-8"}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("h3",{className:"text-xl font-semibold mb-4 text-white",children:["Past Events (",q.length,")"]}),(0,c.jsx)("div",{className:"space-y-4",children:q.map((e=>(0,c.jsxs)("div",{onClick:()=>d(e),className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl p-6 cursor-pointer transition-colors ".concat((null===r||void 0===r?void 0:r.id)===e.id?"ring-2 ring-indigo-500":"hover:bg-gray-700"),children:[(0,c.jsxs)("div",{className:"flex justify-between items-start",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"text-xl font-bold mb-2 text-white",children:e.name}),(0,c.jsx)("p",{className:"text-gray-300 mb-4",children:e.description}),(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("span",{className:"text-sm text-gray-400",children:new Date(e.date).toLocaleDateString()}),(0,c.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-indigo-900 text-indigo-200",children:m[e.event_type]})]})]}),(0,c.jsx)("button",{onClick:t=>{t.stopPropagation(),F(e.id)},className:"text-red-400 hover:text-red-500",children:"Delete"})]}),e.image_url&&(0,c.jsx)("div",{className:"mt-4",children:(0,c.jsx)("img",{src:e.image_url,alt:"Event Image",className:"w-full h-48 object-cover rounded-md"})})]},e.id)))})]})]})]})}),r&&(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-2xl font-bold mb-4 text-white",children:"Edit Event"}),(0,c.jsxs)("form",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl p-6 mb-8 space-y-4 text-gray-900 dark:text-white",onSubmit:async e=>{e.preventDefault();const{data:n,error:a}=await i.N.from("events").update({name:r.name,description:r.description,date:r.date,location:r.location,event_type:r.event_type,points:r.points,image_url:r.image_url,check_in_code:r.check_in_code,is_code_expired:r.is_code_expired,check_in_form_url:""}).eq("id",r.id);a?console.error("Error updating event:",a):(console.log("Event updated successfully:",n),t())},children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Event Title"}),(0,c.jsx)("input",{type:"text",value:r.name,onChange:e=>d((0,n.A)((0,n.A)({},r),{},{name:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Description"}),(0,c.jsx)("textarea",{value:r.description,onChange:e=>d((0,n.A)((0,n.A)({},r),{},{description:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:3,required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Date"}),(0,c.jsx)("input",{type:"datetime-local",value:r.date,onChange:e=>d((0,n.A)((0,n.A)({},r),{},{date:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Location"}),(0,c.jsx)("input",{type:"text",value:r.location,onChange:e=>d((0,n.A)((0,n.A)({},r),{},{location:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Event Type"}),(0,c.jsx)("select",{value:r.event_type,onChange:e=>d((0,n.A)((0,n.A)({},r),{},{event_type:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:Object.entries(m).map((e=>{let[t,r]=e;return(0,c.jsx)("option",{value:t,children:r},t)}))})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Points"}),(0,c.jsx)("input",{type:"number",value:r.points,onChange:e=>d((0,n.A)((0,n.A)({},r),{},{points:Number(e.target.value)})),min:"0",className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Event Image URL"}),(0,c.jsx)("input",{type:"url",value:r.image_url||"",onChange:e=>d((0,n.A)((0,n.A)({},r),{},{image_url:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Check-in Code"}),(0,c.jsx)("input",{type:"text",value:r.check_in_code||"",onChange:e=>d((0,n.A)((0,n.A)({},r),{},{check_in_code:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-600 bg-gray-700 text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Code Expired"}),(0,c.jsx)("input",{type:"checkbox",checked:r.is_code_expired,onChange:e=>d((0,n.A)((0,n.A)({},r),{},{is_code_expired:e.target.checked})),className:"ml-2"})]}),(0,c.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mt-4",children:"Save"})]}),(0,c.jsx)(g,{eventId:r.id,onSuccess:()=>{t()}})]}),j&&(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,c.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[(0,c.jsx)("h3",{className:"text-xl font-bold mb-4 text-white",children:"Confirm Delete"}),(0,c.jsx)("p",{className:"text-gray-300 mb-6",children:"Are you sure you want to delete this event? This action cannot be undone."}),(0,c.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,c.jsx)("button",{onClick:()=>{_(!1),N(null)},className:"px-4 py-2 text-gray-300 hover:text-white",children:"Cancel"}),(0,c.jsx)("button",{onClick:async()=>{if(k)try{const{error:e}=await i.N.from("events").delete().eq("id",k);if(e)throw e;t(),(null===r||void 0===r?void 0:r.id)===k&&d(null)}catch(e){console.error("Error deleting event:",e)}finally{_(!1),N(null)}},className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Delete"})]})]})})]})}},1033:(e,t,r)=>{r.d(t,{s:()=>a});var n=r(9950);function a(e){let{title:t}=e;return(0,n.useEffect)((()=>(document.title="VSA - ".concat(t),()=>{document.title="VSA"})),[t]),null}},4158:(e,t,r)=>{r.d(t,{L:()=>s});var n=r(1920),a=r(2348);function s(){const{data:e=[],isLoading:t,error:r,refetch:s}=(0,n.useQuery)({queryKey:["events"],queryFn:async()=>{const{data:e,error:t}=await a.N.from("events").select("*").order("date",{ascending:!0});if(t)throw t;return e},staleTime:3e5});return{events:e,loading:t,error:r,refreshEvents:s}}},6268:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(8),a=r(9950),s=r(2348);function i(){const[e,t]=(0,a.useState)(!1),[r,i]=(0,a.useState)(null),o=(0,a.useCallback)((async(e,r)=>{try{t(!0),i(null),console.log("Starting check-in process:",{eventId:e,code:r});const{data:n,error:a}=await s.N.from("events").select("*").eq("id",e).single();if(console.log("Event fetch result:",{event:n,eventError:a}),a)throw console.error("Error fetching event:",a),a;if(!n)throw console.error("Event not found"),new Error("Event not found");if(n.is_code_expired)throw console.error("Code expired"),new Error("Check-in code has expired");if(n.check_in_code!==r)throw console.error("Invalid code:",{provided:r,expected:n.check_in_code}),new Error("Invalid check-in code");const{data:{user:o},error:l}=await s.N.auth.getUser();if(console.log("Current user:",{user:o,userError:l}),l)throw console.error("Error getting user:",l),l;if(!o)throw console.error("No user found"),new Error("User not authenticated");const{data:d,error:c}=await s.N.from("event_attendance").select("id, event_id, user_id").eq("event_id",e).eq("user_id",o.id).maybeSingle();if(console.log("Existing check-in check:",{existingCheckIn:d,checkInError:c}),c)throw console.error("Error checking existing check-in:",c),c;if(d)throw console.error("Already checked in"),new Error("You have already checked in to this event");console.log("Recording attendance with points:",n.points);const{data:g,error:u}=await s.N.from("event_attendance").insert({event_id:e,user_id:o.id,points_earned:n.points,check_in_type:"code"}).select().single();if(console.log("Insert result:",{insertData:g,insertError:u}),u)throw console.error("Error inserting attendance:",u),u;const{data:m,error:h}=await s.N.from("user_points").select("points").eq("user_id",o.id).single();if(console.log("Current points:",{currentPoints:m,currentPointsError:h}),h&&"PGRST116"!==h.code)throw console.error("Error getting current points:",h),h;const x=(null===m||void 0===m?void 0:m.points)||0,b=x+n.points;console.log("Updating points:",{currentTotal:x,newTotal:b,pointsToAdd:n.points});const{data:v,error:p}=await s.N.from("user_points").upsert({user_id:o.id,points:b},{onConflict:"user_id",ignoreDuplicates:!1}).select().single();if(console.log("Points update result:",{pointsData:v,pointsError:p}),p)throw console.error("Error updating points:",p),p;return console.log("Successfully checked in"),!0}catch(n){return console.error("Error in checkInWithCode:",n),i(n instanceof Error?n:new Error("Failed to check in")),!1}finally{t(!1)}}),[]),l=(0,a.useCallback)((async(e,r,n)=>{try{var a;t(!0),i(null);const{data:o,error:l}=await s.N.from("event_attendance").select("*").eq("event_id",e).eq("user_id",r).single();if(l&&"PGRST116"!==l.code)throw l;if(o)throw new Error("User has already checked in to this event");const{error:d}=await s.N.from("event_attendance").insert({event_id:e,user_id:r,points_earned:n,check_in_type:"manual",checked_in_by:null===(a=(await s.N.auth.getUser()).data.user)||void 0===a?void 0:a.id});if(d)throw d;return!0}catch(o){return i(o instanceof Error?o:new Error("Failed to check in")),!1}finally{t(!1)}}),[]),d=(0,a.useCallback)((async e=>{try{t(!0),i(null);const{data:r,error:n}=await s.N.from("event_attendance").select("\n          *,\n          user:user_id (\n            email,\n            user_profiles (\n              first_name,\n              last_name\n            )\n          )\n        ").eq("event_id",e).order("checked_in_at",{ascending:!1});if(n)throw n;return r}catch(r){return i(r instanceof Error?r:new Error("Failed to fetch attendance")),null}finally{t(!1)}}),[]),c=(0,a.useCallback)((async e=>{try{t(!0),i(null),console.log("Fetching attendance for user:",e);const{data:r,error:a}=await s.N.from("event_attendance").select("*").eq("user_id",e);console.log("Simple query result:",{simpleData:r,simpleError:a});const{data:o,error:l}=await s.N.from("event_attendance").select("\n          id,\n          event_id,\n          user_id,\n          points_earned,\n          check_in_type,\n          checked_in_at,\n          events!inner (\n            id,\n            name,\n            description,\n            date,\n            location,\n            points,\n            event_type,\n            check_in_form_url,\n            image_url,\n            check_in_code,\n            is_code_expired\n          )\n        ").eq("user_id",e).order("checked_in_at",{ascending:!1});if(console.log("Full query result:",{data:o,error:l}),l)throw console.error("Error fetching attendance:",l),l;const d=null===o||void 0===o?void 0:o.map((e=>(0,n.A)((0,n.A)({},e),{},{event:e.events[0]})));return console.log("Transformed data:",d),d}catch(r){return console.error("Error in getUserAttendance:",r),i(r instanceof Error?r:new Error("Failed to fetch attendance")),null}finally{t(!1)}}),[]);return{loading:e,error:r,checkInWithCode:o,manuallyCheckIn:l,getEventAttendance:d,getUserAttendance:c}}},9326:(e,t,r)=>{r.d(t,{z:()=>i});var n=r(8429),a=r(2074),s=r(4414);function i(){const e=(0,n.zy)(),t=t=>e.pathname===t;return(0,s.jsx)("nav",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg p-4 mb-8",children:(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(a.N_,{to:"/admin/events",className:"px-4 py-2 rounded-lg transition-colors duration-200 ".concat(t("/admin/events")?"bg-indigo-600 text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:"Events"}),(0,s.jsx)(a.N_,{to:"/admin/gallery",className:"px-4 py-2 rounded-lg transition-colors duration-200 ".concat(t("/admin/gallery")?"bg-indigo-600 text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:"Gallery"}),(0,s.jsx)(a.N_,{to:"/admin/feedback",className:"px-4 py-2 rounded-lg transition-colors duration-200 ".concat(t("/admin/feedback")?"bg-indigo-600 text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:"Feedback"})]})})}}}]);