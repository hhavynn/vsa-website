"use strict";(self.webpackChunkvsa_website=self.webpackChunkvsa_website||[]).push([[48],{6048:(e,t,r)=>{r.r(t),r.d(t,{Profile:()=>m});var n=r(5961),a=r(6268),s=r(6668),i=r(9950),o=r(2080),l=r(7196),c=r(2348),d=r(1132),h=r(4414);const x={other:"General Events",gbm:"General Body Meeting",mixer:"Mixer",winter_retreat:"Winter Retreat",vcn:"VCN",wildn_culture:"Wild n' Culture",external_event:"External Event"};function g(){const{user:e}=(0,n.A)(),[t,r]=(0,i.useState)(0),[a,s]=(0,i.useState)([]),[o,l]=(0,i.useState)([]),[g,u]=(0,i.useState)(!0);return(0,i.useEffect)((()=>{(async()=>{if(e)try{const{data:n,error:i}=await c.N.from("user_points").select("points").eq("user_id",e.id).single();if(i)throw i;r((null===n||void 0===n?void 0:n.points)||0);const{data:o,error:d}=await c.N.from("event_attendance").select("event_id").eq("user_id",e.id);if(d)throw d;if(o){const e=o.map((e=>e.event_id)),{data:t,error:r}=await c.N.from("events").select("*").in("id",e);if(r)throw r;s(t||[])}const h=a.filter((e=>"gbm"===e.event_type)).length,x=a.filter((e=>"mixer"===e.event_type)).length,g=a.filter((e=>"vcn"===e.event_type)).length,u=a.filter((e=>"wildn_culture"===e.event_type)).length;l([{id:"gbm_master",name:"GBM Master",description:"Attended 5 GBMs",icon:"\ud83c\udf93",unlocked:h>=5,progress:h,total:5},{id:"social_butterfly",name:"Social Butterfly",description:"Attended 3 mixers",icon:"\ud83e\udd8b",unlocked:x>=3,progress:x,total:3},{id:"vcn_star",name:"VCN Star",description:"Participated in VCN",icon:"\u2b50",unlocked:g>0},{id:"vcn_attendee",name:"VCN Attendee",description:"Attended VCN as an audience member",icon:"\ud83c\udfad",unlocked:g>0},{id:"culture_enthusiast",name:"Culture Enthusiast",description:"Attended Wild n' Culture",icon:"\ud83c\udfaa",unlocked:u>0},{id:"point_collector",name:"Point Collector",description:"Earned 100 points",icon:"\ud83c\udfc6",unlocked:t>=100,progress:t,total:100}])}catch(n){console.error("Error fetching user data:",n)}finally{u(!1)}})()}),[e,a]),g?(0,h.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,h.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):(0,h.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[(0,h.jsxs)(d.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6",children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Points Earned"}),(0,h.jsx)("div",{className:"text-4xl font-bold text-indigo-600 dark:text-indigo-400",children:t}),(0,h.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Keep attending events to earn more points!"})]}),(0,h.jsxs)(d.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6",children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Events Attended"}),(0,h.jsx)("div",{className:"text-4xl font-bold text-indigo-600 dark:text-indigo-400",children:a.length}),(0,h.jsx)("div",{className:"mt-4 space-y-2",children:Object.entries(x).map((e=>{let[t,r]=e;const n=a.filter((e=>e.event_type===t)).length;return(0,h.jsxs)("div",{className:"flex justify-between text-gray-700 dark:text-gray-300",children:[(0,h.jsx)("span",{children:r}),(0,h.jsx)("span",{children:n})]},t)}))})]}),(0,h.jsxs)(d.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6",children:[(0,h.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Achievements"}),(0,h.jsx)("div",{className:"space-y-4",children:o.map((e=>(0,h.jsx)("div",{className:"p-4 rounded-lg ".concat(e.unlocked?"bg-indigo-50 dark:bg-indigo-900/50":"bg-gray-50 dark:bg-gray-700/50"),children:(0,h.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,h.jsx)("div",{className:"p-2 rounded-full ".concat(e.unlocked?"bg-indigo-100 dark:bg-indigo-800":"bg-gray-200 dark:bg-gray-600"),children:(0,h.jsx)("svg",{className:"w-6 h-6 ".concat(e.unlocked?"text-indigo-600 dark:text-indigo-400":"text-gray-400 dark:text-gray-500"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"font-semibold ".concat(e.unlocked?"text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400"),children:e.name}),(0,h.jsx)("p",{className:"text-sm ".concat(e.unlocked?"text-gray-600 dark:text-gray-300":"text-gray-500 dark:text-gray-500"),children:e.description}),void 0!==e.progress&&(0,h.jsxs)("div",{className:"mt-2",children:[(0,h.jsx)("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full",children:(0,h.jsx)("div",{className:"h-2 bg-indigo-600 dark:bg-indigo-400 rounded-full",style:{width:"".concat(e.progress/(e.total||1)*100,"%")}})}),(0,h.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.progress," / ",e.total]})]})]})]})},e.id)))})]})]})})}var u=r(6601);function m(){const{user:e}=(0,n.A)(),{getUserAttendance:t,loading:r,error:d}=(0,a.Z)(),{points:x}=(0,s.P)(),[m,p]=(0,i.useState)([]),[v,f]=(0,i.useState)(null),[y,w]=(0,i.useState)({totalEvents:0,eventsThisMonth:0,badgesEarned:0});if((0,i.useEffect)((()=>{(async()=>{if(e)try{const{data:t,error:r}=await c.N.from("user_profiles").select("first_name, last_name").eq("id",e.id).single();if(r)throw r;f(t)}catch(d){console.error("Error fetching user profile:",d)}})()}),[e]),(0,i.useEffect)((()=>{(async()=>{if(e){const r=await t(e.id);if(r){const e=r.filter((e=>null!=e.event));p(e);const t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1),a=e.filter((e=>e.event&&new Date(e.event.date)>=n)).length;w({totalEvents:e.length,eventsThisMonth:a,badgesEarned:0})}}})()}),[e,t]),!e)return(0,h.jsx)("div",{children:"Please sign in to view your profile."});if(r)return(0,h.jsx)("div",{children:"Loading..."});if(d)return(0,h.jsxs)("div",{children:["Error: ",d.message]});const k=null!==v&&void 0!==v&&v.first_name&&null!==v&&void 0!==v&&v.last_name?"".concat(v.first_name," ").concat(v.last_name):e.email;return(0,h.jsxs)("div",{className:"container mx-auto px-4 py-8 bg-gray-50 text-gray-900 dark:bg-gray-950 dark:text-white transition-colors duration-300",children:[(0,h.jsx)("h1",{className:"text-3xl font-bold mb-8 text-white dark:text-gray-900",children:"Profile"}),(0,h.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 mb-8",children:(0,h.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,h.jsxs)("div",{className:"relative group",onClick:e=>e.stopPropagation(),children:[(0,h.jsx)(u.e,{size:"lg",showUploadButton:!0}),(0,h.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none",children:(0,h.jsx)("div",{className:"bg-black bg-opacity-50 rounded-full p-2",children:(0,h.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})}),(0,h.jsx)("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-3 py-1 rounded text-sm opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none",children:"Click to upload photo"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-2 text-gray-900 dark:text-white",children:k}),(0,h.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,h.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,h.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,h.jsx)("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),(0,h.jsxs)("span",{className:"text-lg font-medium text-gray-900 dark:text-white",children:[x," points"]})]}),(0,h.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,h.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,h.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),(0,h.jsxs)("span",{className:"text-lg font-medium text-gray-900 dark:text-white",children:[y.totalEvents," events attended"]})]})]})]})]})}),(0,h.jsx)(g,{}),(0,h.jsx)(l.T,{children:(0,h.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,h.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 mb-8",children:[(0,h.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Event Attendance History"}),0===m.length?(0,h.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No events attended yet."}):(0,h.jsx)("div",{className:"overflow-x-auto",children:(0,h.jsx)("div",{className:"flex space-x-4 pb-4",children:m.map((e=>e.event&&(0,h.jsxs)("div",{className:"flex-shrink-0 w-64 bg-gray-100 dark:bg-gray-700 rounded-lg p-4",children:[(0,h.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:e.event.name}),(0,h.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:(0,o.A)(new Date(e.event.date),"MMM d, yyyy")}),(0,h.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["Type: ",e.event.event_type.replace(/_/g," ").toUpperCase()]}),(0,h.jsxs)("p",{className:"text-sm text-green-600 dark:text-green-400",children:["Points Earned: ",e.points_earned]})]},e.id)))})})]})})})]})}},6268:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(8),a=r(9950),s=r(2348);function i(){const[e,t]=(0,a.useState)(!1),[r,i]=(0,a.useState)(null),o=(0,a.useCallback)((async(e,r)=>{try{t(!0),i(null),console.log("Starting check-in process:",{eventId:e,code:r});const{data:n,error:a}=await s.N.from("events").select("*").eq("id",e).single();if(console.log("Event fetch result:",{event:n,eventError:a}),a)throw console.error("Error fetching event:",a),a;if(!n)throw console.error("Event not found"),new Error("Event not found");if(n.is_code_expired)throw console.error("Code expired"),new Error("Check-in code has expired");if(n.check_in_code!==r)throw console.error("Invalid code:",{provided:r,expected:n.check_in_code}),new Error("Invalid check-in code");const{data:{user:o},error:l}=await s.N.auth.getUser();if(console.log("Current user:",{user:o,userError:l}),l)throw console.error("Error getting user:",l),l;if(!o)throw console.error("No user found"),new Error("User not authenticated");const{data:c,error:d}=await s.N.from("event_attendance").select("id, event_id, user_id").eq("event_id",e).eq("user_id",o.id).maybeSingle();if(console.log("Existing check-in check:",{existingCheckIn:c,checkInError:d}),d)throw console.error("Error checking existing check-in:",d),d;if(c)throw console.error("Already checked in"),new Error("You have already checked in to this event");console.log("Recording attendance with points:",n.points);const{data:h,error:x}=await s.N.from("event_attendance").insert({event_id:e,user_id:o.id,points_earned:n.points,check_in_type:"code"}).select().single();if(console.log("Insert result:",{insertData:h,insertError:x}),x)throw console.error("Error inserting attendance:",x),x;const{data:g,error:u}=await s.N.from("user_points").select("points").eq("user_id",o.id).single();if(console.log("Current points:",{currentPoints:g,currentPointsError:u}),u&&"PGRST116"!==u.code)throw console.error("Error getting current points:",u),u;const m=(null===g||void 0===g?void 0:g.points)||0,p=m+n.points;console.log("Updating points:",{currentTotal:m,newTotal:p,pointsToAdd:n.points});const{data:v,error:f}=await s.N.from("user_points").upsert({user_id:o.id,points:p},{onConflict:"user_id",ignoreDuplicates:!1}).select().single();if(console.log("Points update result:",{pointsData:v,pointsError:f}),f)throw console.error("Error updating points:",f),f;return console.log("Successfully checked in"),!0}catch(n){return console.error("Error in checkInWithCode:",n),i(n instanceof Error?n:new Error("Failed to check in")),!1}finally{t(!1)}}),[]),l=(0,a.useCallback)((async(e,r,n)=>{try{var a;t(!0),i(null);const{data:o,error:l}=await s.N.from("event_attendance").select("*").eq("event_id",e).eq("user_id",r).single();if(l&&"PGRST116"!==l.code)throw l;if(o)throw new Error("User has already checked in to this event");const{error:c}=await s.N.from("event_attendance").insert({event_id:e,user_id:r,points_earned:n,check_in_type:"manual",checked_in_by:null===(a=(await s.N.auth.getUser()).data.user)||void 0===a?void 0:a.id});if(c)throw c;return!0}catch(o){return i(o instanceof Error?o:new Error("Failed to check in")),!1}finally{t(!1)}}),[]),c=(0,a.useCallback)((async e=>{try{t(!0),i(null);const{data:r,error:n}=await s.N.from("event_attendance").select("\n          *,\n          user:user_id (\n            email,\n            user_profiles (\n              first_name,\n              last_name\n            )\n          )\n        ").eq("event_id",e).order("checked_in_at",{ascending:!1});if(n)throw n;return r}catch(r){return i(r instanceof Error?r:new Error("Failed to fetch attendance")),null}finally{t(!1)}}),[]),d=(0,a.useCallback)((async e=>{try{t(!0),i(null),console.log("Fetching attendance for user:",e);const{data:r,error:a}=await s.N.from("event_attendance").select("*").eq("user_id",e);console.log("Simple query result:",{simpleData:r,simpleError:a});const{data:o,error:l}=await s.N.from("event_attendance").select("\n          id,\n          event_id,\n          user_id,\n          points_earned,\n          check_in_type,\n          checked_in_at,\n          events!inner (\n            id,\n            name,\n            description,\n            date,\n            location,\n            points,\n            event_type,\n            check_in_form_url,\n            image_url,\n            check_in_code,\n            is_code_expired\n          )\n        ").eq("user_id",e).order("checked_in_at",{ascending:!1});if(console.log("Full query result:",{data:o,error:l}),l)throw console.error("Error fetching attendance:",l),l;const c=null===o||void 0===o?void 0:o.map((e=>(0,n.A)((0,n.A)({},e),{},{event:e.events[0]})));return console.log("Transformed data:",c),c}catch(r){return console.error("Error in getUserAttendance:",r),i(r instanceof Error?r:new Error("Failed to fetch attendance")),null}finally{t(!1)}}),[]);return{loading:e,error:r,checkInWithCode:o,manuallyCheckIn:l,getEventAttendance:c,getUserAttendance:d}}},7196:(e,t,r)=>{r.d(t,{T:()=>s});r(9950);var n=r(1132),a=r(4414);const s=e=>{let{children:t}=e;return(0,a.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},children:t})}}}]);